<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Regresión logística | Introducción al Aprendizaje automático en ciencias de la salud</title>
  <meta name="description" content="4 Regresión logística | Introducción al Aprendizaje automático en ciencias de la salud" />
  <meta name="generator" content="bookdown 0.23 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Regresión logística | Introducción al Aprendizaje automático en ciencias de la salud" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Regresión logística | Introducción al Aprendizaje automático en ciencias de la salud" />
  
  
  

<meta name="author" content="Juan R González" />


<meta name="date" content="2022-10-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="validación-cruzada.html"/>
<link rel="next" href="caret.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Aprendizaje Automático</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preámbulo</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#instalación-de-librerías-necesarias-para-el-curso"><i class="fa fa-check"></i><b>1.1</b> Instalación de librerías necesarias para el curso</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introducción-al-aprendizaje-automático.html"><a href="introducción-al-aprendizaje-automático.html"><i class="fa fa-check"></i><b>2</b> Introducción al Aprendizaje Automático</a></li>
<li class="chapter" data-level="3" data-path="validación-cruzada.html"><a href="validación-cruzada.html"><i class="fa fa-check"></i><b>3</b> Validación cruzada</a>
<ul>
<li class="chapter" data-level="3.1" data-path="validación-cruzada.html"><a href="validación-cruzada.html#validación-en-un-conjunto-de-datos-externo"><i class="fa fa-check"></i><b>3.1</b> Validación en un conjunto de datos externo</a></li>
<li class="chapter" data-level="3.2" data-path="validación-cruzada.html"><a href="validación-cruzada.html#leave-one-out-cross-validation-loocv"><i class="fa fa-check"></i><b>3.2</b> Leave-one-out cross validation (LOOCV)</a></li>
<li class="chapter" data-level="3.3" data-path="validación-cruzada.html"><a href="validación-cruzada.html#k-fold-cross-validation-k-fold-cv"><i class="fa fa-check"></i><b>3.3</b> K-fold cross validation (K-fold CV)</a></li>
<li class="chapter" data-level="3.4" data-path="validación-cruzada.html"><a href="validación-cruzada.html#uso-de-cv-para-estimar-el-hiper-parámetro"><i class="fa fa-check"></i><b>3.4</b> Uso de CV para estimar el hiper-parámetro</a></li>
<li class="chapter" data-level="3.5" data-path="validación-cruzada.html"><a href="validación-cruzada.html#uso-de-bootstrap"><i class="fa fa-check"></i><b>3.5</b> Uso de bootstrap</a></li>
<li class="chapter" data-level="3.6" data-path="validación-cruzada.html"><a href="validación-cruzada.html#imputación-de-datos-faltantes-información-extra-para-los-que-venís-al-curso"><i class="fa fa-check"></i><b>3.6</b> Imputación de datos faltantes (Información extra para los que venís al curso)</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="regresión-logística.html"><a href="regresión-logística.html"><i class="fa fa-check"></i><b>4</b> Regresión logística</a>
<ul>
<li class="chapter" data-level="4.1" data-path="regresión-logística.html"><a href="regresión-logística.html#la-función-logit-inversa"><i class="fa fa-check"></i><b>4.1</b> La función logit inversa</a></li>
<li class="chapter" data-level="4.2" data-path="regresión-logística.html"><a href="regresión-logística.html#ejemplo-de-regresión-logística"><i class="fa fa-check"></i><b>4.2</b> Ejemplo de regresión logística</a></li>
<li class="chapter" data-level="4.3" data-path="regresión-logística.html"><a href="regresión-logística.html#coeficientes-de-regresión-logística-como-probabilidades"><i class="fa fa-check"></i><b>4.3</b> Coeficientes de regresión logística como probabilidades</a></li>
<li class="chapter" data-level="4.4" data-path="regresión-logística.html"><a href="regresión-logística.html#coeficientes-de-regresión-logística-como-razones-de-odds"><i class="fa fa-check"></i><b>4.4</b> Coeficientes de regresión logística como razones de odds</a></li>
<li class="chapter" data-level="4.5" data-path="regresión-logística.html"><a href="regresión-logística.html#capacidad-predictiva-de-un-modelo-de-clasificación"><i class="fa fa-check"></i><b>4.5</b> Capacidad predictiva de un modelo de clasificación</a></li>
<li class="chapter" data-level="4.6" data-path="regresión-logística.html"><a href="regresión-logística.html#ejemplo-de-regresión-logística-modelización-de-riesgo-diabetes"><i class="fa fa-check"></i><b>4.6</b> Ejemplo de regresión logística: modelización de riesgo diabetes</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="regresión-logística.html"><a href="regresión-logística.html#modelo-simple"><i class="fa fa-check"></i><b>4.6.1</b> Modelo simple</a></li>
<li class="chapter" data-level="4.6.2" data-path="regresión-logística.html"><a href="regresión-logística.html#agregar-predictores-y-evaluar-el-ajuste"><i class="fa fa-check"></i><b>4.6.2</b> Agregar predictores y evaluar el ajuste</a></li>
<li class="chapter" data-level="4.6.3" data-path="regresión-logística.html"><a href="regresión-logística.html#análisis-de-interacciones"><i class="fa fa-check"></i><b>4.6.3</b> Análisis de interacciones</a></li>
<li class="chapter" data-level="4.6.4" data-path="regresión-logística.html"><a href="regresión-logística.html#gráfico-de-la-interacción"><i class="fa fa-check"></i><b>4.6.4</b> Gráfico de la interacción</a></li>
<li class="chapter" data-level="4.6.5" data-path="regresión-logística.html"><a href="regresión-logística.html#uso-del-modelo-para-predecir-probabilidades"><i class="fa fa-check"></i><b>4.6.5</b> Uso del modelo para predecir probabilidades</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="regresión-logística.html"><a href="regresión-logística.html#creación-de-un-modelo-y-validación"><i class="fa fa-check"></i><b>4.7</b> Creación de un modelo y validación</a></li>
<li class="chapter" data-level="4.8" data-path="regresión-logística.html"><a href="regresión-logística.html#nomogramas"><i class="fa fa-check"></i><b>4.8</b> Nomogramas</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="caret.html"><a href="caret.html"><i class="fa fa-check"></i><b>5</b> La librería <code>caret</code></a>
<ul>
<li class="chapter" data-level="5.1" data-path="caret.html"><a href="caret.html#pre-procesado"><i class="fa fa-check"></i><b>5.1</b> Pre-procesado</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="caret.html"><a href="caret.html#creación-de-variables"><i class="fa fa-check"></i><b>5.1.1</b> Creación de variables</a></li>
<li class="chapter" data-level="5.1.2" data-path="caret.html"><a href="caret.html#predictores-con-poca-variabilidad"><i class="fa fa-check"></i><b>5.1.2</b> Predictores con poca variabilidad</a></li>
<li class="chapter" data-level="5.1.3" data-path="caret.html"><a href="caret.html#identificación-de-predictores-correlacionados"><i class="fa fa-check"></i><b>5.1.3</b> Identificación de predictores correlacionados</a></li>
<li class="chapter" data-level="5.1.4" data-path="caret.html"><a href="caret.html#centrado-y-escalado"><i class="fa fa-check"></i><b>5.1.4</b> Centrado y escalado</a></li>
<li class="chapter" data-level="5.1.5" data-path="caret.html"><a href="caret.html#imputación"><i class="fa fa-check"></i><b>5.1.5</b> Imputación</a></li>
<li class="chapter" data-level="5.1.6" data-path="caret.html"><a href="caret.html#pre-procesado-con-la-librería-recipes"><i class="fa fa-check"></i><b>5.1.6</b> Pre-procesado con la librería <code>recipes</code></a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="caret.html"><a href="caret.html#visualización"><i class="fa fa-check"></i><b>5.2</b> Visualización</a></li>
<li class="chapter" data-level="5.3" data-path="caret.html"><a href="caret.html#ejemplo-completo-creación-de-modelo-diagnóstico-para-cáncer-de-mama"><i class="fa fa-check"></i><b>5.3</b> Ejemplo completo: creación de modelo diagnóstico para cáncer de mama</a></li>
<li class="chapter" data-level="5.4" data-path="caret.html"><a href="caret.html#creación-de-un-modelo-predictivo"><i class="fa fa-check"></i><b>5.4</b> Creación de un modelo predictivo</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="árboles-de-decisión.html"><a href="árboles-de-decisión.html"><i class="fa fa-check"></i><b>6</b> Árboles de decisión</a>
<ul>
<li class="chapter" data-level="6.1" data-path="árboles-de-decisión.html"><a href="árboles-de-decisión.html#árboles-de-clasificación"><i class="fa fa-check"></i><b>6.1</b> Árboles de clasificación</a></li>
<li class="chapter" data-level="6.2" data-path="árboles-de-decisión.html"><a href="árboles-de-decisión.html#área-bajo-la-curva-roc"><i class="fa fa-check"></i><b>6.2</b> Área bajo la curva ROC</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="árboles-de-decisión.html"><a href="árboles-de-decisión.html#entrenamiento-con-caret"><i class="fa fa-check"></i><b>6.2.1</b> Entrenamiento con <code>caret</code></a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="árboles-de-decisión.html"><a href="árboles-de-decisión.html#árboles-de-regresión"><i class="fa fa-check"></i><b>6.3</b> Árboles de regresión</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="árboles-de-decisión.html"><a href="árboles-de-decisión.html#entrenamiento-con-caret-1"><i class="fa fa-check"></i><b>6.3.1</b> Entrenamiento con <code>caret</code></a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="árboles-de-decisión.html"><a href="árboles-de-decisión.html#bagged-trees"><i class="fa fa-check"></i><b>6.4</b> Bagged trees</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="árboles-de-decisión.html"><a href="árboles-de-decisión.html#bagging-árboles-de-clasificación"><i class="fa fa-check"></i><b>6.4.1</b> Bagging árboles de clasificación</a></li>
<li class="chapter" data-level="6.4.2" data-path="árboles-de-decisión.html"><a href="árboles-de-decisión.html#bagging-árboles-de-regresión"><i class="fa fa-check"></i><b>6.4.2</b> Bagging árboles de regresión</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="árboles-de-decisión.html"><a href="árboles-de-decisión.html#random-forest"><i class="fa fa-check"></i><b>6.5</b> Random Forest</a></li>
<li class="chapter" data-level="6.6" data-path="árboles-de-decisión.html"><a href="árboles-de-decisión.html#random-forest-pn"><i class="fa fa-check"></i><b>6.6</b> Random Forest p&gt;&gt;n</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="respuesta-no-balanceada.html"><a href="respuesta-no-balanceada.html"><i class="fa fa-check"></i><b>7</b> Respuesta no balanceada</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introducción al Aprendizaje automático en ciencias de la salud</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="regresión-logística" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Regresión logística</h1>
<p>Este capítulo introduce la regresión logística como el método más sencillo para crear modelos predictivos en problemas de clasificación que es el principal objetivo del curso. Se cubrirán los siguientes temas:</p>
<ul>
<li>Conocer la función logística</li>
<li>Cómo interpretar los coeficientes de los modelos</li>
<li>Cómo evaluar la capacidad predictiva de un modelo</li>
<li>Cómo interpretar variables</li>
<li>Ilustrar un ejemplo de análisis completo</li>
<li>Aprender a hacer nomogramas fijos y dinámicos</li>
</ul>
<p>Hasta ahora, nuestra variable de resultado era continua. Pero si la variable de resultado es binaria (0/1, “No”/“Sí”), entonces nos enfrentamos a un problema de <em>clasificación</em>. El objetivo de la clasificación es crear un modelo capaz de <em>clasificar</em> el resultado — y, cuando se usa el modelo para la predicción, nuevas observaciones— en una de dos categorías. La regresión logística se introduce en el contexto de la epidemiología como un modelo de regresión que extiende el modelo lineal cuando nuestra variable respuesta es binaria, pero tambié es, probablemente, el método estadístico más utilizado para la clasificación y el más sencillo. Una de las grandes ventajas de estos modelos respecto a otros que veremo más adelante es que este método produce un <em>modelo de probabilidad</em> para nuestra variable resultado. En otras palabras, los valores ajustados en un modelo logístico o logit no son binarios sino que son <em>probabilidades</em> que representan la probabilidad de que el resultado pertenezca a una de nuestras dos categorías.</p>
<p>Desafortunadamente, debemos afrontar nuevas complicaciones cuando trabajamos con regresión logística, lo que hace que estos modelos sean inherentemente más difíciles de interpretar que los modelos lineales. Las complicaciones surgen del hecho de que con la regresión logística modelamos la probabilidad de que <span class="math inline">\(y\)</span> = 1, y la probabilidad siempre se escala entre 0 y 1. Pero el predictor lineal, <span class="math inline">\(X_i \beta\)</span>, oscila entre <span class="math inline">\(\pm \infty\)</span> (donde <span class="math inline">\(X\)</span> representa todos los predictores del modelo). Esta diferencia de escala requiere transformar la variable de resultado, lo cual se logra con la función logit:</p>
<p><span class="math display">\[
\text{logit}(x) = \text{log}\left( \frac{x}{1-x} \right)
\]</span></p>
<p>La función logit asigna el rango del resultado (0,1) al rango del predictor lineal <span class="math inline">\((-\infty, +\infty)\)</span>. El resultado transformado, <span class="math inline">\(\text{logit} (x)\)</span>, se expresa en logaritmos de probabilidades (<span class="math inline">\(\frac{x}{1-x}\)</span> se conoce como probabilidades del resultado - razón de odds en inglés - momios en castellano). Así que el modelo también se puede escribir como:</p>
<p><span class="math display">\[\text{Pr}(y_i = 1) = p_i\]</span></p>
<p><span class="math display">\[\text{logit}(p_i) =  X_i\beta\]</span></p>
<p>Las probabilidades logarítmicas (e.g. el log-odds) no tienen interpretación (que no sea el signo y la magnitud) y deben transformarse nuevamente en cantidades interpretables, ya sea en <em>probabilidades</em>, usando el logit inverso, o en <em>razones de probabilidades</em>, mediante el uso de la función exponencial. Discutimos ambas transformaciones a continuación.</p>
<div id="la-función-logit-inversa" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> La función logit inversa</h2>
<p>El modelo logístico se puede escribir, alternativamente, usando el logit inverso:</p>
<p><span class="math display">\[
\operatorname{Pr}(y_i = 1 | X_i) = \operatorname{logit}^{-1}(X_i \beta)
\]</span></p>
<p>donde <span class="math inline">\(y_i\)</span> es la respuesta binaria, <span class="math inline">\(\operatorname{logit}^{- 1}\)</span> es la función logit inversa y <span class="math inline">\(X_i \beta\)</span> es el predictor lineal. Podemos interpretar esta formulación diciendo que la probabilidad de que <span class="math inline">\(y = 1\)</span> es igual al logit inverso del predictor lineal <span class="math inline">\((X_i, \ beta)\)</span>. Por lo tanto, podemos expresar los valores ajustados del modelo logístico y los coeficientes como probabilidades utilizando la transformación logit inversa. Pero, ¿qué es exactamente el logit inverso? Pues es:</p>
<p><span class="math display">\[\operatorname{logit}^{-1}(x) = \frac{e^{x}}{1 + e^{x}}\]</span></p>
<p>donde <span class="math inline">\(e\)</span> es la función exponencial.</p>
<p>Podemos tener una idea de cómo la función logit inversa transforma el predictor lineal mediante una gráfica. Aquí usamos un rango arbitrario de valores de x en (-6, 6) para demostrar la transformación.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="regresión-logística.html#cb31-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">6</span>, <span class="dv">6</span>, .<span class="dv">01</span>)</span>
<span id="cb31-2"><a href="regresión-logística.html#cb31-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">exp</span>(x)<span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(x))</span>
<span id="cb31-3"><a href="regresión-logística.html#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">x =</span> x, <span class="at">y =</span> y), <span class="fu">aes</span>(x, y)) <span class="sc">+</span></span>
<span id="cb31-4"><a href="regresión-logística.html#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb31-5"><a href="regresión-logística.html#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(logit<span class="sc">^-</span><span class="dv">1</span>,<span class="st">&quot;(x)&quot;</span>))) <span class="sc">+</span></span>
<span id="cb31-6"><a href="regresión-logística.html#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;y = &quot;</span>, logit<span class="sc">^-</span><span class="dv">1</span>,<span class="st">&quot;(x)&quot;</span>)))</span></code></pre></div>
<p><img src="fig_out/unnamed-chunk-18-1.png" width="672" /></p>
<p>Los valores <span class="math inline">\(x\)</span>, que van de -6 a 6, son comprimidos por la función logit inversa en el rango 0-1. El logit inverso es curvo, por lo que la diferencia esperada en <span class="math inline">\(y\)</span> correspondiente a una diferencia fija en <span class="math inline">\(x\)</span> no es constante. A valores bajos y valores altos de <span class="math inline">\(x\)</span>, un cambio de unidad corresponde a un cambio muy pequeño en <span class="math inline">\(y\)</span>, mientras que en la mitad de la curva un pequeño cambio en <span class="math inline">\(x\)</span> corresponde a un cambio relativamente grande en <span class="math inline">\(y\)</span>. En la regresión lineal, la diferencia esperada en <span class="math inline">\(y\)</span> correspondiente a una diferencia fija en <span class="math inline">\(x\)</span> es, por el contrario, constante. <em>Por lo tanto, cuando interpretamos los resultados logísticos debemos elegir en qué parte de la curva queremos evaluar la probabilidad del resultado, dado el modelo.</em></p>
</div>
<div id="ejemplo-de-regresión-logística" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Ejemplo de regresión logística</h2>
<p>Ilustremos estos conceptos utilizando el conjunto de datos “Default” del ISLR. Este conjunto de datos simulado contiene una variable binaria que representa el incumplimiento en los pagos de la tarjeta de crédito (variable “default”), que modelaremos como una función de la variable “balance” (la cantidad de deuda que tiene la tarjeta) y la variable “income” (ingresos).</p>
<p>Los datos pueden obtenerse mediante</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="regresión-logística.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ISLR)</span>
<span id="cb32-2"><a href="regresión-logística.html#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Default)</span>
<span id="cb32-3"><a href="regresión-logística.html#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(Default)</span></code></pre></div>
<pre><code>&#39;data.frame&#39;:   10000 obs. of  4 variables:
 $ default: Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 1 1 1 1 1 1 1 1 ...
 $ student: Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 2 1 1 1 2 1 2 1 1 ...
 $ balance: num  730 817 1074 529 786 ...
 $ income : num  44362 12106 31767 35704 38463 ...</code></pre>
<p>Antes de Primero visualizaremos cómo es esta relación.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="regresión-logística.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb34-2"><a href="regresión-logística.html#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="regresión-logística.html#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Default, <span class="fu">aes</span>(<span class="at">x =</span> balance, <span class="at">y =</span> income, <span class="at">col =</span> default)) <span class="sc">+</span></span>
<span id="cb34-4"><a href="regresión-logística.html#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb34-5"><a href="regresión-logística.html#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Balance vs. Income by Default&quot;</span>)</span></code></pre></div>
<p><img src="fig_out/unnamed-chunk-20-1.png" width="672" /></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="regresión-logística.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(</span>
<span id="cb35-2"><a href="regresión-logística.html#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Default, <span class="fu">aes</span>(default, balance)) <span class="sc">+</span> </span>
<span id="cb35-3"><a href="regresión-logística.html#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb35-4"><a href="regresión-logística.html#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Balance by Default&quot;</span>) <span class="sc">+</span> </span>
<span id="cb35-5"><a href="regresión-logística.html#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;balance&quot;</span>),</span>
<span id="cb35-6"><a href="regresión-logística.html#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Default, <span class="fu">aes</span>(default, income)) <span class="sc">+</span> </span>
<span id="cb35-7"><a href="regresión-logística.html#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb35-8"><a href="regresión-logística.html#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Income by Default&quot;</span>) <span class="sc">+</span> </span>
<span id="cb35-9"><a href="regresión-logística.html#cb35-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;income&quot;</span>),</span>
<span id="cb35-10"><a href="regresión-logística.html#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="fig_out/unnamed-chunk-20-2.png" width="672" /></p>
<p>Claramente, los valores altos de saldo están asociados con el incumplimiento en todos los niveles de ingresos. Esto sugiere que los ingresos en realidad no son un fuerte predictor de incumplimiento, en comparación con el saldo, que es exactamente lo que vemos en los diagramas de cajas.</p>
<p>Exploremos estas relaciones usando la regresión logística. En R ajustamos un modelo logístico usando la función <code>glm ()</code> con <code>family = binomial</code>.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> Centraremos y escalaremos las variables para facilitar la interpretación.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="regresión-logística.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glm</span>(default <span class="sc">~</span> balance <span class="sc">+</span> income, </span>
<span id="cb36-2"><a href="regresión-logística.html#cb36-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> Default, </span>
<span id="cb36-3"><a href="regresión-logística.html#cb36-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial) <span class="sc">%&gt;%</span></span>
<span id="cb36-4"><a href="regresión-logística.html#cb36-4" aria-hidden="true" tabindex="-1"></a>    standardize <span class="sc">%&gt;%</span></span>
<span id="cb36-5"><a href="regresión-logística.html#cb36-5" aria-hidden="true" tabindex="-1"></a>    display</span></code></pre></div>
<pre><code>glm(formula = default ~ z.balance + z.income, family = binomial, 
    data = Default)
            coef.est coef.se
(Intercept) -6.13     0.19  
z.balance    5.46     0.22  
z.income     0.56     0.13  
---
  n = 10000, k = 3
  residual deviance = 1579.0, null deviance = 2920.6 (difference = 1341.7)</code></pre>
<p>NOTA: Se puede apreciar la ventaja del uso de tidyverse (pipe) - no se necesita crear las variables estandarizadas, ni guardar el resultado para luego hacer un print</p>
<p>Interpretamos esta salida exactamente como lo haríamos para un modelo lineal con un predictor centrado y escalado:</p>
<ul>
<li><em>Intercept</em>: -6,13 representa las probabilidades logarítmicas (log odds) de incumplimiento cuando el saldo es promedio (835.37) y el ingreso es promedio (3.351698^{4} ). (Promedio porque las variables se han centrado).</li>
<li><em>z.balance</em>: 5.46 representa el cambio predicho en las probabilidades logarítmicas de incumplimiento asociado con un aumento de 1 unidad en el saldo (z.balance), manteniendo constante el ingreso (z.income). Un aumento de 1 unidad en el saldo (z.balance) es equivalente a un aumento de 2 desviaciones estándar en el saldo (balance) (967.43). Este coeficiente es estadísticamente significativo ya que 5.46 - 2 x .22 &gt; 0 (el IC del 95% que no contiene 0 indica significación estadística).</li>
<li><em>z.income</em>: .56 representa el cambio predicho en las probabilidades logarítmicas (log odds) de incumplimiento asociadas con un aumento de 1 unidad en el ingreso (z.income), manteniendo constante el balance (z.balance). Un aumento de 1 unidad en el ingreso (z.income) es equivalente a un aumento de 2 desviaciones estándar en el ingreso (income) (2.667328^{4}). Este coeficiente también es estadísticamente significativo ya que .56 - 2 x .13 &gt; 0.</li>
</ul>
<p>¿Qué significa que las probabilidades logarítmicas de incumplimiento aumenten en 5.46 o .56? En términos precisos, ¿quién sabe? Para que estas cantidades tengan una mejor interpretación, necesitamos transformarlas, ya sea en probabilidades (odds) o en razones de probabilidades (razón de odds -&gt; odds ratio). Sin embargo, debemos señalar que el signo y la magnitud de los coeficientes si son informativas: la relación con el incumplimiento del pago es positiva en ambos casos y, como ya se había visto de forma gráfica en los diagramas de cajas, el efecto del saldo (balance) es mucho mayor que el del ingreso (income).</p>
</div>
<div id="coeficientes-de-regresión-logística-como-probabilidades" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Coeficientes de regresión logística como probabilidades</h2>
<p>Podemos dar una interpretación más específica de la regresión logística más allá del efecto y magnitud. Para ello, podemos usar la función logit inversa para convertir las probabilidades logarítmicas (log-odds) de incumplimiento de pago en las tarjetas (cuando el saldo y los ingresos son promedio) en una probabilidad:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="regresión-logística.html#cb38-1" aria-hidden="true" tabindex="-1"></a>invlogit <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">exp</span>(x)<span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(x))</span>
<span id="cb38-2"><a href="regresión-logística.html#cb38-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">invlogit</span>(<span class="sc">-</span><span class="fl">6.13</span> <span class="sc">+</span> <span class="fl">5.46</span> <span class="sc">*</span> <span class="dv">0</span> <span class="sc">+</span> .<span class="dv">56</span> <span class="sc">*</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>[1] 0.002171854</code></pre>
<p>La probabilidad de incumplimiento para aquellos con un saldo promedio de tarjeta de crédito de (835.37) y un ingreso promedio de (3.351698^{4}) es de hecho bastante bajo: solo 0.002. Asimismo, podemos calcular el cambio en la probabilidad de incumplimiento en el pago asociado con un aumento de 1 unidad en el saldo, manteniendo el ingreso constante en el promedio (z.ingreso=0). Esto equivaldría a aumentar el saldo en casi 1000$, de 835.37 a 1802.8.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="regresión-logística.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">invlogit</span>(<span class="sc">-</span><span class="fl">6.13</span> <span class="sc">+</span> <span class="fl">5.46</span> <span class="sc">*</span> <span class="dv">1</span>) <span class="sc">-</span> <span class="fu">invlogit</span>(<span class="sc">-</span><span class="fl">6.13</span> <span class="sc">+</span> <span class="fl">5.46</span> <span class="sc">*</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>[1] 0.336325</code></pre>
</div>
<div id="coeficientes-de-regresión-logística-como-razones-de-odds" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Coeficientes de regresión logística como razones de odds</h2>
<p>También podemos interpretar los coeficientes de regresión logística como <em>razones de odds</em> (OR).<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> Si dos resultados tienen probabilidades <span class="math inline">\((p, 1-p)\)</span>, entonces <span class="math inline">\(\frac {p} {1-p}\)</span> se conoce como <em>odds</em> (probabilidades o momio) del resultado. Las <em>odds</em> son simplemente diferentes formas de representar la misma información: <span class="math inline">\(\text{odds} = \frac{p}{1-p}\)</span> y <span class="math inline">\(p = \frac{\text{odds}} {1+ \text{odds}}\)</span>. Por ejemplo, una <em>odds</em> de 1 es equivalente a una <em>odds</em> de .5 — es decir, resultados igualmente probables para <span class="math inline">\(p\)</span> y <span class="math inline">\(1-p\)</span>: <span class="math inline">\(\text{odds(p = .5)} = \frac{.5}{1-.5} = 1\)</span> y <span class="math inline">\(p(\text{oods} = 1) = \frac{\text{1}}{1 + 1} = .5.\)</span></p>
<p>La razón de dos odds es una OR:</p>
<p><span class="math display">\[
\frac{\frac{p_2}{1-p_2}}{\frac{p_1}{1-p_1}}
\]</span></p>
<p>Una razón de <em>odds</em> se puede interpretar como un cambio en la probabilidad. Por ejemplo, un cambio en la probabilidad de <span class="math inline">\(p_1 = .33\)</span> a <span class="math inline">\(p_2 = .5\)</span> da como resultado un OR de 2, de la siguiente manera:</p>
<p><span class="math display">\[
\frac{\frac{.5}{.5}}{\frac{.33}{.66}} = \frac{1}{.5} = 2
\]</span></p>
<p>También podemos interpretar el OR como el aumento porcentual de las probabilidades de un evento. Aquí, un OR de 2 equivale a aumentar las probabilidades en un 100%, de 0,5 a 1.</p>
<p>Recordemos que representamos el modelo logit de esta manera:</p>
<p><span class="math display">\[
\text{log} \left(\frac{p}{1-p}\right) = \alpha + \beta x
\]</span></p>
<p>La parte izquierda de la ecuación, expresado como logaritmos de probabilidades, está en la misma escala que la derecha derecho: <span class="math inline">\(\pm \infty\)</span>. Por lo tanto, no hay no linealidad en esta relación, y aumentar <span class="math inline">\(x\)</span> en 1 unidad tiene el mismo efecto que en la regresión lineal: cambia el resultado predicho en <span class="math inline">\(\beta\)</span>. Entonces, pasar de <span class="math inline">\(x\)</span> a <span class="math inline">\(x + 1\)</span> equivale a sumar <span class="math inline">\(\beta\)</span> a ambos lados de la ecuación anterior. Centrándonos solo en el lado izquierdo, tenemos, después de exponenciar, las probabilidades originales multiplicadas por <span class="math inline">\(e^\beta\)</span>:</p>
<p><span class="math display">\[
e^{\text{log} \left(\frac{p}{1-p}\right) + \beta} = \frac{p}{1-p} *e^ \beta
\]</span></p>
<p>(ya que <span class="math inline">\(e^{a+b} = e^a*e^b\)</span>).</p>
<p>Podemos pensar en <span class="math inline">\(e^\beta\)</span> como el cambio de la odds del resultado cuando <span class="math inline">\(x\)</span> cambia en 1 unidad, que se puede representar, utilizando la formulación anterior, como una OR:</p>
<p><span class="math display">\[
\frac{\frac{p_2}{1-p_2}}{\frac{p_1}{1-p_1}} = \frac{\frac{p_1}{1-p_1} * e^\beta 
}{\frac{p_1}{1-p_1}} = e^\beta.
\]</span></p>
<p>Por lo tanto, <span class="math inline">\(e^\beta\)</span> se puede interpretar como el cambio en las probabilidades asociadas con un aumento de 1 unidad en <span class="math inline">\(x\)</span>, expresado en términos porcentuales. En el caso de OR = <span class="math inline">\(\frac{1}{. 5} = 2\)</span>, el porcentaje de aumento en las probabilidades del resultado es del 100%. Cuando la OR es <span class="math inline">\(&gt;2\)</span> se suele expresar como x-veces más (OR=3.5, hay 3.5 veces más probabilidad de observar el evento que no observarlo cuando se cambia <span class="math inline">\(x\)</span> en 1 unidad), y cuando la OR es <span class="math inline">\(&lt;1\)</span> se suele hablar de protección a no tener el evento y el porcentaje se calcula como 1-OR.</p>
<p>Apliquemos esta información a nuestro modelo anterior de aplicando la exponencial a los coeficientes de saldo e ingresos:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="regresión-logística.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fl">5.46</span>)</span></code></pre></div>
<pre><code>[1] 235.0974</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="regresión-logística.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(.<span class="dv">56</span>)</span></code></pre></div>
<pre><code>[1] 1.750673</code></pre>
<p>Podemos interpretar estos ORs como el porcentaje o cambio multiplicativo en las probabilidades asociadas con un aumento de 1 unidad en el predictor (mientras se mantienen constantes los demás), de 1 a 235 (un aumento de 23,400%) en el caso de balance, y de 1 a 1,75 (un aumento del 75%) para los ingresos. Por ejemplo, podemos decir que la probabilidad de incumplimiento es un 75% mayor cuando los ingresos aumentan en 1 unidad.</p>
<p>Cuando las variables predictoras son categóricas (como en biomedicina: sexo, estadío tumoral, fumar, beber, …) la interpretación se hace más sencilla porque el cambio de 1 unidad en estas variables, supone el cambio de una categoría respecto a la basal (ya que se usan <em>dummy variables</em>). Así, por ejemplo, si nuestro outcomes tener cáncer de pulmón o no, y nuestro predictor es ser fumanor o no, si nuestros análisis nos dan una OR de 6 asociado a ser fumador, la interpretación sería: "La odds (probabilidad, abusando de lenguaje - también riesgo si el outcome es poco frecuente) de sufrir cáncer de pulmón es 6 veces mayor en los fumadores que en los no fumadores.</p>
</div>
<div id="capacidad-predictiva-de-un-modelo-de-clasificación" class="section level2" number="4.5">
<h2><span class="header-section-number">4.5</span> Capacidad predictiva de un modelo de clasificación</h2>
<p>Podemos evaluar el rendimiento (es decir, la capacidad predictiva) del modelo logístico utilizando el AIC, así como mediante el uso de otras medidas como: la desviación (<em>deviance</em>) residual, la precisión, la sensibilidad, la especificidad y el área bajo la curva (AUC).</p>
<p>Al igual que AIC, la <em>deviance</em> es una medida de error, por lo que una <em>deviance</em> más baja significa un mejor ajuste a los datos. Esperamos que la desviación disminuya en 1 para cada predictor, por lo que con un predictor informativo (e.g. variable imporante para el modleo), la <em>deviance</em> disminuirá en más de 1. Deviance = <span class="math inline">\(-2ln(L)\)</span>, donde <span class="math inline">\(ln\)</span> es el logaritmo natural y <span class="math inline">\(L\)</span> es la función de verosimilitud . Veámoslo con nuestro ejemplo:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="regresión-logística.html#cb46-1" aria-hidden="true" tabindex="-1"></a>logistic_model1 <span class="ot">&lt;-</span> </span>
<span id="cb46-2"><a href="regresión-logística.html#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(default <span class="sc">~</span> balance, </span>
<span id="cb46-3"><a href="regresión-logística.html#cb46-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> Default, </span>
<span id="cb46-4"><a href="regresión-logística.html#cb46-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial)</span>
<span id="cb46-5"><a href="regresión-logística.html#cb46-5" aria-hidden="true" tabindex="-1"></a>logistic_model1<span class="sc">$</span>deviance</span></code></pre></div>
<pre><code>[1] 1596.452</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="regresión-logística.html#cb48-1" aria-hidden="true" tabindex="-1"></a>logistic_model2 <span class="ot">&lt;-</span> </span>
<span id="cb48-2"><a href="regresión-logística.html#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(default <span class="sc">~</span> balance <span class="sc">+</span> income, </span>
<span id="cb48-3"><a href="regresión-logística.html#cb48-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> Default, </span>
<span id="cb48-4"><a href="regresión-logística.html#cb48-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial)</span>
<span id="cb48-5"><a href="regresión-logística.html#cb48-5" aria-hidden="true" tabindex="-1"></a>logistic_model2<span class="sc">$</span>deviance</span></code></pre></div>
<pre><code>[1] 1578.966</code></pre>
<p>En este caso, la <em>deviance</em> se redujo en más de 1, lo que indica que los ingresos mejoran el ajuste del modelo. Podemos hacer una prueba formal de la diferencia usando, como para los modelos lineales, la prueba de razón de verosimilitud:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="regresión-logística.html#cb50-1" aria-hidden="true" tabindex="-1"></a>lmtest<span class="sc">::</span><span class="fu">lrtest</span>(logistic_model1, logistic_model2)</span></code></pre></div>
<pre><code>Likelihood ratio test

Model 1: default ~ balance
Model 2: default ~ balance + income
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)    
1   2 -798.23                         
2   3 -789.48  1 17.485  2.895e-05 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>También podemos traducir las probabilidades de un modelo logístico para el incumplimiento del pago en predicciones de clase asignando “Sí” (predeterminado) a probabilidades mayores o iguales a .5 y “No” (sin valor predeterminado) a probabilidades menores que .5, y luego contar el número de veces que el modelo asigna la clase predeterminada correcta. Si dividimos este número por el total de observaciones, habremos calculado la “precisión”. La precisión se utiliza a menudo como medida del rendimiento del modelo.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="regresión-logística.html#cb52-1" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">fitted</span>(logistic_model2) <span class="sc">&gt;=</span> .<span class="dv">5</span>, <span class="st">&quot;Yes&quot;</span>, <span class="st">&quot;No&quot;</span>) </span>
<span id="cb52-2"><a href="regresión-logística.html#cb52-2" aria-hidden="true" tabindex="-1"></a>(<span class="fu">length</span>(<span class="fu">which</span>(preds <span class="sc">==</span> Default<span class="sc">$</span>default)) <span class="sc">/</span> <span class="fu">nrow</span>(Default))<span class="sc">*</span><span class="dv">100</span></span></code></pre></div>
<pre><code>[1] 97.37</code></pre>
<p>El modelo es 97.37% preciso. Valores superirores al 50% mostrarían una mejora en la predicción ya que por azar, se espera que el modelo tenga una precisión del 50%.</p>
<p>Una forma sencilla de obtener un buen modelo de clasificación sería asignar a todos la categoría más frecuente. Por ejemplo, en nuestros datos, la clase mayoritaria es “No” para la variable incimpliminto por un amplio margen (9667 a 333). La mayoría de las personas no incumplen. ¿Cuál es nuestra precisión, entonces, si simplemente predecimos “No” para todos los casos? La proporción de “No” en los datos es 96.67%, por lo que si siempre predijimos “No” esa sería nuestra precisión (9667 / (9667 + 333) = .9667). El modelo logístico, sorprendentemente, ofrece solo una ligera mejora.</p>
<p>Sin embargo, al evaluar el rendimiento del clasificador, debemos reconocer que no todos los errores son iguales y que la precisión tiene limitaciones como métrica de rendimiento. En algunos casos, el modelo puede haber predicho el incumplimiento cuando no lo había. Esto se conoce como “falso positivo”. En otros casos, el modelo puede haber predicho que no hubo incumplimiento cuando hubo incumplimiento. Esto se conoce como “falso negativo”. En la clasificación, utilizamos lo que se conoce como matriz de confusión para resumir estos diferentes tipos de errores del modelo, denominados así porque la matriz resume cómo se confunde el modelo. Usaremos la función <code>confusionMatrix ()</code> de la librería <code>caret</code> para calcular rápidamente estos valores:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="regresión-logística.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="fu">as.factor</span>(preds), Default<span class="sc">$</span>default, <span class="at">positive =</span> <span class="st">&quot;Yes&quot;</span>)</span></code></pre></div>
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction   No  Yes
       No  9629  225
       Yes   38  108
                                          
               Accuracy : 0.9737          
                 95% CI : (0.9704, 0.9767)
    No Information Rate : 0.9667          
    P-Value [Acc &gt; NIR] : 3.067e-05       
                                          
                  Kappa : 0.4396          
                                          
 Mcnemar&#39;s Test P-Value : &lt; 2.2e-16       
                                          
            Sensitivity : 0.3243          
            Specificity : 0.9961          
         Pos Pred Value : 0.7397          
         Neg Pred Value : 0.9772          
             Prevalence : 0.0333          
         Detection Rate : 0.0108          
   Detection Prevalence : 0.0146          
      Balanced Accuracy : 0.6602          
                                          
       &#39;Positive&#39; Class : Yes             
                                          </code></pre>
<p>Esta función produce una gran cantidad de resultados. Podemos ver que informa la misma precisión que calculamos anteriormente: .97. La matriz de confusión 2 x 2 está en la parte superior. Podemos caracterizar estos 4 valores en la matriz de la siguiente manera:</p>
<ol style="list-style-type: decimal">
<li>9629 negativos verdaderos (TN): cuando el modelo predice correctamente “No”</li>
<li>108 verdaderos positivos (TP): cuando el modelo predice correctamente “Sí”</li>
<li>225 falsos negativos (FN): cuando el modelo predice incorrectamente “No”</li>
<li>38 falsos positivos (FP): cuando el modelo predice incorrectamente “Sí”</li>
</ol>
<p>La siguiente tabla resume estas posibilidades:</p>
<table>
<tbody>
<tr class="odd">
<td align="left"></td>
<td align="left">Reference</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Predicted</td>
<td align="left">No</td>
<td align="left">Yes</td>
</tr>
<tr class="odd">
<td align="left">No</td>
<td align="left">TN</td>
<td align="left">FN</td>
</tr>
<tr class="even">
<td align="left">Yes</td>
<td align="left">FP</td>
<td align="left">TP</td>
</tr>
</tbody>
</table>
<p>Hay dos medidas clave, además de la precisión, para caracterizar el rendimiento del modelo. Mientras que la precisión mide el error general, la sensibilidad y la especificidad miden errores específicos de clase.</p>
<ul>
<li><em>Precisión</em> = 1 - (FP + FN) / Total:</li>
</ul>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="regresión-logística.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">-</span> (<span class="dv">38</span> <span class="sc">+</span> <span class="dv">225</span>) <span class="sc">/</span> <span class="dv">10000</span></span></code></pre></div>
<pre><code>[1] 0.9737</code></pre>
<ul>
<li><em>Sensibilidad</em> (o la tasa de verdaderos positivos): TP / (TP + FN). En este caso, la sensibilidad mide la proporción de incumplimientos que se clasificaron correctamente como tales.</li>
</ul>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="regresión-logística.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="dv">108</span> <span class="sc">/</span> (<span class="dv">108</span> <span class="sc">+</span> <span class="dv">225</span>) </span></code></pre></div>
<pre><code>[1] 0.3243243</code></pre>
<ul>
<li><em>Especificidad</em> (o la tasa de verdaderos negativos): TN / (TN + FP). En este caso, la especificidad mide la proporción de no incumplimientos que se clasificaron correctamente como tales.</li>
</ul>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="regresión-logística.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="dv">9629</span> <span class="sc">/</span> (<span class="dv">9629</span> <span class="sc">+</span> <span class="dv">38</span>) </span></code></pre></div>
<pre><code>[1] 0.9960691</code></pre>
<p>¿Por qué deberíamos considerar estos errores específicos de clase? Todos los modelos tienen errores, pero no todos los errores del modelo son igualmente importantes. Por ejemplo, un falso negativo — prediciendo incorrectamente que un prestatario no incurrirá en incumplimiento — puede ser un error costoso para un banco, si el incumplimiento se hubiera podido prevenir mediante la intervención. Pero, por otro lado, un falso positivo, que predice incorrectamente que un prestatario incurrirá en incumplimiento, puede desencadenar una advertencia innecesaria que irrita a los clientes. Los errores que comete un modelo se pueden controlar ajustando el umbral de decisión utilizado para asignar probabilidades predichas a las clases. Usamos un umbral de probabilidad de .5 para clasificar los incumplimientos en los pagos. Si el umbral se establece en .1, por el contrario, la precisión general disminuiría, pero también lo haría el número de falsos negativos, lo que podría ser deseable. El modelo luego atraparía a más morosos, lo que ahorraría dinero al banco, pero eso tendría un costo: más falsos positivos (clientes potencialmente irritados).</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="regresión-logística.html#cb62-1" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(<span class="fu">fitted</span>(logistic_model2) <span class="sc">&gt;=</span> .<span class="dv">1</span>, <span class="st">&quot;Yes&quot;</span>, <span class="st">&quot;No&quot;</span>))</span>
<span id="cb62-2"><a href="regresión-logística.html#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(preds, Default<span class="sc">$</span>default)<span class="sc">$</span>table</span></code></pre></div>
<pre><code>          Reference
Prediction   No  Yes
       No  9105   90
       Yes  562  243</code></pre>
<p>La pregunta de cómo establecer el umbral de decisión —. 5, .1 o algo más — debe responderse con referencia al contexto empresarial.</p>
<p>Una curva de característica operativa del receptor (ROC por sus siglas en ingles) visualiza las compensaciones entre los tipos de errores trazando la especificidad frente a la sensibilidad. El cálculo del área bajo la curva ROC (AUC) nos permite, además, resumir el rendimiento del modelo y comparar modelos. La curva en sí muestra los tipos de errores que cometería el modelo en diferentes umbrales de decisión. Para crear una curva ROC usamos la función <code>roc ()</code> del paquete pROC, y mostramos los valores de sensibilidad / especificidad asociados con los umbrales de decisión de .1 y .5:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="regresión-logística.html#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb64-2"><a href="regresión-logística.html#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotROC)</span>
<span id="cb64-3"><a href="regresión-logística.html#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">plot</span>(<span class="fu">roc</span>(<span class="fu">factor</span>(<span class="fu">ifelse</span>(Default<span class="sc">$</span>default <span class="sc">==</span> <span class="st">&quot;Yes&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>)), </span>
<span id="cb64-4"><a href="regresión-logística.html#cb64-4" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">fitted</span>(logistic_model2)), <span class="at">print.thres =</span> <span class="fu">c</span>(.<span class="dv">1</span>, .<span class="dv">5</span>), </span>
<span id="cb64-5"><a href="regresión-logística.html#cb64-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">print.auc =</span> T))</span></code></pre></div>
<p><img src="fig_out/unnamed-chunk-34-1.png" width="672" /></p>
<p>Un modelo con una precisión del 50%, es decir, un clasificador aleatorio, tendría una curva ROC que siguiera la línea de referencia diagonal. Un modelo con una precisión del 100%, un clasificador perfecto, tendría una curva ROC siguiendo los márgenes del triángulo superior. Cada punto de la curva ROC representa un par de sensibilidad / especificidad correspondiente a un umbral de decisión particular. Cuando establecimos el umbral de decisión en .1, la sensibilidad fue .73 (243 / (243 + 90)) y la especificidad fue .94 (9105 / (9105 + 562)). Ese punto se muestra en la curva. Del mismo modo, cuando establecimos el umbral de decisión en .5, la sensibilidad fue .32 y la especificidad fue .996. Ese punto también está en la curva. ¿Qué umbral de decisión es óptimo? Nuevamente, depende del problema (pensad en cáncer o en este ejemplo de dinero). Las curvas ROC nos permiten elegir los errores específicos de clase que podemos cometer.</p>
<p>El AUC es el resumen de cómo funciona el modelo en cada umbral de decisión. En general, los modelos con AUC más altos son mejores. Esta medida nos servirá para comparar métodos de aprendizaje automático que iremos aprendiendo durante el curso.</p>
</div>
<div id="ejemplo-de-regresión-logística-modelización-de-riesgo-diabetes" class="section level2" number="4.6">
<h2><span class="header-section-number">4.6</span> Ejemplo de regresión logística: modelización de riesgo diabetes</h2>
<p>Para este ejemplo usaremos el conjunto de datos Pima, incluido en la librería <code>MASS</code> que contienen esta información:</p>
<blockquote>
<p>Una población de mujeres que tenían al menos 21 años, de ascendencia indígena Pima y que vivían cerca de Phoenix, Arizona, se sometieron a pruebas de diabetes de acuerdo con los criterios de la Organización Mundial de la Salud. Los datos fueron recopilados por el Instituto Nacional de Diabetes y Enfermedades Digestivas y Renales de EE. UU. Usaremos información para 532 mujeres con datos completos después de eliminar los datos (principalmente faltantes) sobre la insulina sérica.</p>
</blockquote>
<p>El conjunto de datos incluye las siguientes variables:</p>
<ol style="list-style-type: decimal">
<li>npreg: número de embarazos</li>
<li>glu: concentración de glucosa en plasma a 2 horas en una prueba de tolerancia oral a la glucosa</li>
<li>bp: presión arterial diastólica (mm Hg)</li>
<li>piel: grosor del pliegue cutáneo del tríceps (mm)</li>
<li>bmi: índice de masa corporal (peso en kg / (altura en m) ^ 2)</li>
<li>ped: función del pedigrí de la diabetes</li>
<li>age: Edad (años)</li>
<li>type: Sí o No (diabetes)</li>
</ol>
<p>La variable resultado es “type”, que indica si una persona tiene diabetes. Los datos están divididos en un conjunto de entrenamiento y otro test que combinaremos para ilustrar este ejemplo.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="regresión-logística.html#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(arm)</span>
<span id="cb65-2"><a href="regresión-logística.html#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb65-3"><a href="regresión-logística.html#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Pima.tr&quot;</span>)</span>
<span id="cb65-4"><a href="regresión-logística.html#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Pima.te&quot;</span>)</span>
<span id="cb65-5"><a href="regresión-logística.html#cb65-5" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Pima.te, Pima.tr)</span>
<span id="cb65-6"><a href="regresión-logística.html#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(d)</span></code></pre></div>
<pre><code>&#39;data.frame&#39;:   532 obs. of  8 variables:
 $ npreg: int  6 1 1 3 2 5 0 1 3 9 ...
 $ glu  : int  148 85 89 78 197 166 118 103 126 119 ...
 $ bp   : int  72 66 66 50 70 72 84 30 88 80 ...
 $ skin : int  35 29 23 32 45 19 47 38 41 35 ...
 $ bmi  : num  33.6 26.6 28.1 31 30.5 25.8 45.8 43.3 39.3 29 ...
 $ ped  : num  0.627 0.351 0.167 0.248 0.158 0.587 0.551 0.183 0.704 0.263 ...
 $ age  : int  50 31 21 26 53 51 31 33 27 29 ...
 $ type : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 2 1 1 2 2 2 2 1 1 2 ...</code></pre>
<p>Todos los predictores son enteros o numéricos. Nuestro objetivo es construir un modelo logístico de diabetes para ilustrar cómo interpretar los coeficientes del modelo.</p>
<div id="modelo-simple" class="section level3" number="4.6.1">
<h3><span class="header-section-number">4.6.1</span> Modelo simple</h3>
<p>Comencemos con un modelo simple.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="regresión-logística.html#cb67-1" aria-hidden="true" tabindex="-1"></a>bin_model1 <span class="ot">&lt;-</span> </span>
<span id="cb67-2"><a href="regresión-logística.html#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(type <span class="sc">~</span> bmi <span class="sc">+</span> age, </span>
<span id="cb67-3"><a href="regresión-logística.html#cb67-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> d, </span>
<span id="cb67-4"><a href="regresión-logística.html#cb67-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial)</span>
<span id="cb67-5"><a href="regresión-logística.html#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(bin_model1)</span></code></pre></div>
<pre><code>glm(formula = type ~ bmi + age, family = binomial, data = d)
            coef.est coef.se
(Intercept) -6.26     0.67  
bmi          0.10     0.02  
age          0.06     0.01  
---
  n = 532, k = 3
  residual deviance = 577.2, null deviance = 676.8 (difference = 99.6)</code></pre>
<ul>
<li><em>Intercept</em>: -6.26 es el logaritmo de la probabilidad de tener diabetes cuando bmi = 0 y edad = 0. Dado que ni la edad ni el bmi pueden ser iguales a 0, el intercept no es interpretable en este modelo. Por tanto, tendría sentido centrar las variables para facilitar la interpretación.</li>
<li><em>bmi</em>: .1 es el cambio previsto en el <em>log-odds</em> de diabetes asociado con un aumento de 1 unidad en el bmi, manteniendo la edad constante. Este coeficiente es estadísticamente significativo ya que .1 - 2 x .02 &gt; 0. (Un IC del 95% que no contiene 0 indica significancia estadística) y también porque su p-valor asociacio mediante el test de score es <span class="math inline">\(&lt;0.05\)</span> (usar la función <code>summary ()</code> . Podemos traducir este coeficiente en un OR mediante la exponencial: <span class="math inline">\(e^.1\)</span> = 1.11. Un aumento de 1 unidad en el IMC, manteniendo la edad constante, se asocia con un aumento del 11% en la <em>odds</em> (o, más coloquialmente, la probabilidad) de diabetes.</li>
<li><em>edad</em>: .06 es el cambio predicho en el <em>log-oods</em> de diabetes asociado con un aumento de 1 unidad en la edad, manteniendo constante el bmi. Este coeficiente también es estadísticamente significativo ya que .06 - 2 x .01&gt; 0. El OR para la edad es <span class="math inline">\(e^.06\)</span> = 1.06 lo que indica un aumento del 6% en la probabilidad de sufrir diabetes asociada con un aumento de 1 unidad en la edad.</li>
</ul>
</div>
<div id="agregar-predictores-y-evaluar-el-ajuste" class="section level3" number="4.6.2">
<h3><span class="header-section-number">4.6.2</span> Agregar predictores y evaluar el ajuste</h3>
<p>Ahora ajustaremos un modelo completo (excluyendo “skin”, ya que parece medir casi lo mismo que bmi). ¿Mejora el ajuste?</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="regresión-logística.html#cb69-1" aria-hidden="true" tabindex="-1"></a>bin_model2 <span class="ot">&lt;-</span> </span>
<span id="cb69-2"><a href="regresión-logística.html#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(type <span class="sc">~</span> bmi <span class="sc">+</span> age <span class="sc">+</span> ped <span class="sc">+</span> glu <span class="sc">+</span> npreg <span class="sc">+</span> bp , </span>
<span id="cb69-3"><a href="regresión-logística.html#cb69-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> d, </span>
<span id="cb69-4"><a href="regresión-logística.html#cb69-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial) </span>
<span id="cb69-5"><a href="regresión-logística.html#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(bin_model2)</span></code></pre></div>
<pre><code>glm(formula = type ~ bmi + age + ped + glu + npreg + bp, family = binomial, 
    data = d)
            coef.est coef.se
(Intercept) -9.59     0.99  
bmi          0.09     0.02  
age          0.03     0.01  
ped          1.31     0.36  
glu          0.04     0.00  
npreg        0.12     0.04  
bp          -0.01     0.01  
---
  n = 532, k = 7
  residual deviance = 466.5, null deviance = 676.8 (difference = 210.3)</code></pre>
<p>La <em>deviance</em> disminuye de 577 en el modelo anterior a 466.5 en este modelo, muy por encima de los 4 puntos que debería bajar simplemente al incluir 4 predictores adicionales. Además, el LRT nos indica que estas diferencias son estadísticamente significativas:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="regresión-logística.html#cb71-1" aria-hidden="true" tabindex="-1"></a>lmtest<span class="sc">::</span><span class="fu">lrtest</span>(bin_model1, bin_model2)</span></code></pre></div>
<pre><code>Likelihood ratio test

Model 1: type ~ bmi + age
Model 2: type ~ bmi + age + ped + glu + npreg + bp
  #Df  LogLik Df  Chisq Pr(&gt;Chisq)    
1   3 -288.60                         
2   7 -233.27  4 110.67  &lt; 2.2e-16 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>El segundo modelo es mucho mejor que el primero, lo que también es evidente cuando observamos las matrices de confusión (con el umbral de decisión establecido en .5)</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="regresión-logística.html#cb73-1" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(<span class="fu">fitted</span>(bin_model1) <span class="sc">&gt;</span> .<span class="dv">5</span>, <span class="st">&quot;Yes&quot;</span>, <span class="st">&quot;No&quot;</span>))</span>
<span id="cb73-2"><a href="regresión-logística.html#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(preds, d<span class="sc">$</span>type)<span class="sc">$</span>table</span></code></pre></div>
<pre><code>          Reference
Prediction  No Yes
       No  312 112
       Yes  43  65</code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="regresión-logística.html#cb75-1" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(<span class="fu">fitted</span>(bin_model2) <span class="sc">&gt;</span> .<span class="dv">5</span>, <span class="st">&quot;Yes&quot;</span>, <span class="st">&quot;No&quot;</span>))</span>
<span id="cb75-2"><a href="regresión-logística.html#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(preds, d<span class="sc">$</span>type)<span class="sc">$</span>table</span></code></pre></div>
<pre><code>          Reference
Prediction  No Yes
       No  318  73
       Yes  37 104</code></pre>
<p>Como era de esperar, el modelo completo comete menos errores. Podemos formalizar esta impresión calculando y comparando la precisión del modelo: 1 - (112 + 43) / (112 + 43 + 312 + 65) = 0.71 para el primer modelo, en comparación con 1 - (73 + 37) / (73 + 37 + 318 + 104) =<code>r round (1 - (73 + 37) / (73 + 37 + 318 + 104 ), 2)</code> para el segundo modelo más grande. Los números de verdaderos negativos son cercanos, pero el modelo más grande aumenta sustancialmente el número de verdaderos positivos y reduce el número de falsos negativos, prediciendo incorrectamente que una persona no tiene diabetes (aunque esta sigue siendo la clase de error más grande). Deberíamos comprobar para ver que estos modelos mejoran la precisión sobre un modelo que siempre predice la clase mayoritaria. En este conjunto de datos, “No” es la categoría mayoritaria con 66,7%. Entonces, si siempre predijimos “No”, estaríamos en lo correcto el 66.7% de las veces, que es una precisión menor que cualquiera de los modelos. Las curvas ROC proporcionan una descripción más sistemática del rendimiento del modelo en términos de errores de clasificación errónea.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="regresión-logística.html#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">plot</span>(<span class="fu">roc</span>(d<span class="sc">$</span>type,</span>
<span id="cb77-2"><a href="regresión-logística.html#cb77-2" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">fitted</span>(bin_model1)),</span>
<span id="cb77-3"><a href="regresión-logística.html#cb77-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, </span>
<span id="cb77-4"><a href="regresión-logística.html#cb77-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">main =</span> <span class="st">&quot;ROC curves: logistic model 1 (red) vs. logistic model 2 (blue)&quot;</span>))</span>
<span id="cb77-5"><a href="regresión-logística.html#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">plot</span>(<span class="fu">roc</span>(d<span class="sc">$</span>type,</span>
<span id="cb77-6"><a href="regresión-logística.html#cb77-6" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">fitted</span>(bin_model2)),</span>
<span id="cb77-7"><a href="regresión-logística.html#cb77-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">print.auc =</span> T, </span>
<span id="cb77-8"><a href="regresión-logística.html#cb77-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, </span>
<span id="cb77-9"><a href="regresión-logística.html#cb77-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">add =</span> T))</span></code></pre></div>
<p><img src="fig_out/unnamed-chunk-41-1.png" width="672" /></p>
<p>El modelo más grande es claramente mejor: el AUC es más alto.</p>
</div>
<div id="análisis-de-interacciones" class="section level3" number="4.6.3">
<h3><span class="header-section-number">4.6.3</span> Análisis de interacciones</h3>
<p>Agreguemos una interacción entre dos predictores continuos, ped y glu. Centraremos y escalaremos las entradas para que el coeficiente de la interacción sea interpretable.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="regresión-logística.html#cb78-1" aria-hidden="true" tabindex="-1"></a>bin_model3 <span class="ot">&lt;-</span> </span>
<span id="cb78-2"><a href="regresión-logística.html#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">standardize</span>(<span class="fu">glm</span>(type <span class="sc">~</span> bmi  <span class="sc">+</span> ped <span class="sc">*</span> glu <span class="sc">+</span>  age <span class="sc">+</span> npreg <span class="sc">+</span> bp , </span>
<span id="cb78-3"><a href="regresión-logística.html#cb78-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> d, </span>
<span id="cb78-4"><a href="regresión-logística.html#cb78-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial)) </span>
<span id="cb78-5"><a href="regresión-logística.html#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(bin_model3)</span></code></pre></div>
<pre><code>glm(formula = type ~ z.bmi + z.ped * z.glu + z.age + z.npreg + 
    z.bp, family = binomial, data = d)
            coef.est coef.se
(Intercept) -1.02     0.13  
z.bmi        1.29     0.26  
z.ped        1.02     0.24  
z.glu        2.31     0.27  
z.age        0.53     0.30  
z.npreg      0.87     0.29  
z.bp        -0.19     0.26  
z.ped:z.glu -1.15     0.41  
---
  n = 532, k = 8
  residual deviance = 460.0, null deviance = 676.8 (difference = 216.7)</code></pre>
<p>La interacción mejora el modelo pero no cambia la imagen general del ajuste del modelo en el gráfico de residuos agrupados (no incluido).</p>
<ul>
<li><em>Intercept </em>: -1.02 es el <em>log-odds</em> de diabetes cuando todos los predictores son promedio (ya que hemos centrado y escalado las entradas). La probabilidad de tener diabetes para la mujer promedio en este conjunto de datos es logit<span class="math inline">\(^{- 1}\)</span> (- 1.02) = 0.27.</li>
<li><em>z.bmi</em>: 1.29 es el <em>log-odds</em> de diabetes asociado con un aumento de 1 unidad en z.bmi, manteniendo constantes los demás predictores. <span class="math inline">\(e^{1.29}\)</span> = 3.63 por lo que un aumento de 1 unidad en z.bmi, manteniendo constantes los otros predictores, se asocia con un aumento del 263% en la probabilidad de sufrir diabetes.</li>
<li><em>z.ped</em>: 1.02 es el <em>log-odds</em> de diabetes asociado con un aumento de 1 unidad en z.ped, cuando z.glu = 0 y manteniendo constantes los otros predictores. <span class="math inline">\(e^{1.02}\)</span> = 2.77 por lo que un aumento de 1 unidad en z.ped, cuando z.glu = 0 y manteniendo los otros predictores constantes, se asocia con un aumento del 177% en la probabilidad de sufrir diabetes.</li>
<li><em>z.glu</em>: 2.31 es el <em>log-odds</em> de diabetes asociado con un aumento de 1 unidad en z.glu, cuando z.ped = 0 y manteniendo constantes los demás predictores. <span class="math inline">\(e^{2.31}\)</span> = 10.07 por lo que un aumento de 1 unidad en z.glu, cuando z.ped = 0 y manteniendo los otros predictores constantes, se asocia con un aumento del 907% en la probabilidad de sufrir diabetes.</li>
<li>…. el resto de predictores igual</li>
<li></li>
<li><em>z.ped:z.glu </em>: se añade -1.15 al <em>log-odds</em> de diabetes de z.ped cuando z.glu aumenta en 1 unidad, manteniendo constantes los otros predictores. O, alternativamente, se añade -1.15 al <em>log-odds</em> de diabetes de z.glu por cada unidad adicional de z.ped. Calculamos el OR, como en los otros casos, exponenciando: <span class="math inline">\(e^ {- 1.15}\)</span> = 0.32. El OR para z.ped disminuye en un 68% (1 - .32 = .68) cuando z.glu aumenta en 1 unidad, manteniendo constantes los demás predictores. O, alternativamente, el OR para z.glu disminuye en un 68% con cada unidad adicional de z.ped.</li>
</ul>
</div>
<div id="gráfico-de-la-interacción" class="section level3" number="4.6.4">
<h3><span class="header-section-number">4.6.4</span> Gráfico de la interacción</h3>
<p>Como siempre, debemos visualizar la interacción para comprenderla. Esto es especialmente necesario cuando las relaciones se expresan en términos de probabilidades logarítmicas y razones de probabilidades. Como hemos hecho anteriormente para fines de visualización, dicotomizaremos los predictores en la interacción y, en este caso, para facilitar la interpretación, presentaremos las relaciones en términos de probabilidades. El propósito de los gráficos es la comprensión y la ilustración, por lo que no nos preocupa demasiado la precisión estadística. Resumiremos las relaciones usando una curva loess (estimación no paramétrica de la regresión) para capturar la no linealidad del efecto del predictor (<span class="math inline">\(\pm \infty\)</span>) al rango del resultado binario (0, 1).</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="regresión-logística.html#cb80-1" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>ped_bin <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(d<span class="sc">$</span>ped <span class="sc">&gt;</span> <span class="fu">mean</span>(d<span class="sc">$</span>ped), <span class="st">&quot;above avg&quot;</span>,<span class="st">&quot;below avg&quot;</span>)</span>
<span id="cb80-2"><a href="regresión-logística.html#cb80-2" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>glu_bin <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(d<span class="sc">$</span>glu <span class="sc">&gt;</span> <span class="fu">mean</span>(d<span class="sc">$</span>glu), <span class="st">&quot;above avg&quot;</span>,<span class="st">&quot;below avg&quot;</span>)</span>
<span id="cb80-3"><a href="regresión-logística.html#cb80-3" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>prob <span class="ot">&lt;-</span> <span class="fu">fitted</span>(bin_model3)</span>
<span id="cb80-4"><a href="regresión-logística.html#cb80-4" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>type_num <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(d<span class="sc">$</span>type <span class="sc">==</span> <span class="st">&quot;Yes&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb80-5"><a href="regresión-logística.html#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d, <span class="fu">aes</span>(glu, type_num)) <span class="sc">+</span></span>
<span id="cb80-6"><a href="regresión-logística.html#cb80-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb80-7"><a href="regresión-logística.html#cb80-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="fu">aes</span>(glu, prob, <span class="at">col =</span> ped_bin), <span class="at">se =</span> F) <span class="sc">+</span></span>
<span id="cb80-8"><a href="regresión-logística.html#cb80-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Pr(diabetes)&quot;</span>, <span class="at">title =</span> <span class="st">&quot;Diabetes ~ glu varying by ped_bin&quot;</span>)</span></code></pre></div>
<p><img src="fig_out/unnamed-chunk-43-1.png" width="672" /></p>
<p>La relación entre glu y diabetes depende claramente de los niveles de ped. Como en el caso lineal, las líneas no paralelas indican una interacción. El coeficiente de <em>log-odds</em> negativo para la interacción del modelo indica que a medida que ped aumenta, la fuerza de la relación entre glu y type (diabetes) disminuye. Esto es exactamente lo que vemos en este gráfico:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="regresión-logística.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d, <span class="fu">aes</span>(ped, type_num)) <span class="sc">+</span></span>
<span id="cb81-2"><a href="regresión-logística.html#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb81-3"><a href="regresión-logística.html#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="fu">aes</span>(ped, prob, <span class="at">col =</span> glu_bin), <span class="at">se =</span> F) <span class="sc">+</span></span>
<span id="cb81-4"><a href="regresión-logística.html#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Pr(diabetes)&quot;</span>, <span class="at">title =</span> <span class="st">&quot;Diabetes ~ ped varying by glu_bin&quot;</span>)</span></code></pre></div>
<p><img src="fig_out/unnamed-chunk-44-1.png" width="672" /></p>
<p>La interacción es más difícil de ver aquí porque la escala de ped está comprimida, con la mayoría de las observaciones cercanas a 0. Sin embargo, podemos ver que a medida que glu aumenta, la fuerza de la relación entre ped y diabetes disminuye. Nuevamente, las líneas no paralelas indican la presencia de una interacción.</p>
</div>
<div id="uso-del-modelo-para-predecir-probabilidades" class="section level3" number="4.6.5">
<h3><span class="header-section-number">4.6.5</span> Uso del modelo para predecir probabilidades</h3>
<p>El tamaño del efecto más grande en el modelo anterior con la interacción, con mucho, es z.glu. Por tanto, para comunicar los resultados de este modelo deberíamos concentrarnos en glu. Pero los coeficientes expresados como logaritmos de probabilidades son algo confusos y, lamentablemente, las razones de probabilidades no ayudan a aclarar mucho las cosas. Deberíamos ir al trabajo adicional de traducir los coeficientes del modelo en probabilidades, pero para hacerlo debemos identificar en qué parte de la curva de probabilidad nos gustaría evaluar glu. Escogeremos la región cercana al promedio de z.glu — 0 — y examinaremos el efecto de aumentar z.glu en 1 unidad (que es igual a 2 desviaciones estándar de glu) cuando los otros predictores son promedio. La forma más sencilla de hacer esto es crear una base de datos con los valores de predicción deseados para usar con la función <code>predict ()</code>.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="regresión-logística.html#cb82-1" aria-hidden="true" tabindex="-1"></a>basal <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">z.bmi =</span> <span class="dv">0</span>, <span class="at">z.ped =</span> <span class="dv">0</span>, <span class="at">z.glu =</span> <span class="dv">0</span>, <span class="at">z.age =</span> <span class="dv">0</span>, <span class="at">z.npreg =</span> <span class="dv">0</span>, <span class="at">z.bp =</span> <span class="dv">0</span>)</span>
<span id="cb82-2"><a href="regresión-logística.html#cb82-2" aria-hidden="true" tabindex="-1"></a>glucosa <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">z.bmi =</span> <span class="dv">0</span>, <span class="at">z.ped =</span> <span class="dv">0</span>, <span class="at">z.glu =</span> <span class="dv">1</span>, <span class="at">z.age =</span> <span class="dv">0</span>, <span class="at">z.npreg =</span> <span class="dv">0</span>, <span class="at">z.bp =</span> <span class="dv">0</span>)</span>
<span id="cb82-3"><a href="regresión-logística.html#cb82-3" aria-hidden="true" tabindex="-1"></a>(lo <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">invlogit</span>(<span class="fu">predict</span>(bin_model3, <span class="at">newdata =</span> basal))))</span></code></pre></div>
<pre><code>[1] 0.2652028</code></pre>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="regresión-logística.html#cb84-1" aria-hidden="true" tabindex="-1"></a>(hi <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">invlogit</span>(<span class="fu">predict</span>(bin_model3, <span class="at">newdata =</span> ))))</span></code></pre></div>
<pre><code>  [1] 0.716146591 0.025911688 0.017983270 0.029013744 0.893018807 0.665405710 0.395033985 0.211066662 0.431695033 0.225375587 0.032840692
 [12] 0.443676401 0.022607120 0.418795847 0.194085484 0.411388311 0.122928759 0.771984610 0.760725696 0.088470567 0.953485181 0.785645203
 [23] 0.028409690 0.026232726 0.055457646 0.038181372 0.757850071 0.007630220 0.110507313 0.066603557 0.213559028 0.017048355 0.294579371
 [34] 0.213686248 0.245378175 0.147939308 0.058529536 0.047092679 0.169073996 0.023421517 0.434375748 0.123923484 0.796680824 0.257623355
 [45] 0.236877492 0.032937565 0.075796893 0.459769771 0.014969537 0.214416331 0.409898562 0.024597682 0.736084480 0.071421984 0.863089942
 [56] 0.109813203 0.415148971 0.192888308 0.671705524 0.707181753 0.222687051 0.074378276 0.047288218 0.250211485 0.102873418 0.451885105
 [67] 0.016412055 0.839500999 0.593725195 0.887724350 0.023636511 0.972427462 0.421875342 0.240818110 0.193220347 0.275433738 0.029285367
 [78] 0.858427986 0.792694816 0.428056807 0.241389504 0.359146427 0.159848949 0.126229936 0.089106804 0.965646716 0.021565093 0.504101659
 [89] 0.255700597 0.303575110 0.316087819 0.695623695 0.059157940 0.023850831 0.703188586 0.768676985 0.198583192 0.736445668 0.019832290
[100] 0.911158959 0.794437117 0.023391174 0.082335119 0.536540158 0.491636172 0.875915114 0.830550408 0.453101254 0.050024142 0.017749687
[111] 0.151803493 0.175667620 0.900329614 0.125898408 0.410586667 0.586540636 0.832688763 0.035561910 0.252327286 0.110864806 0.054988088
[122] 0.131662542 0.393097130 0.492496368 0.513182966 0.032671230 0.036078371 0.218212971 0.686096496 0.281975363 0.145884637 0.351411775
[133] 0.239547073 0.725330877 0.392954359 0.354585338 0.328110094 0.183872054 0.649535926 0.189835213 0.750660386 0.100154335 0.253081898
[144] 0.306902095 0.138876568 0.112315917 0.602945913 0.033225614 0.021023766 0.126008933 0.074805807 0.593242488 0.276438109 0.030025810
[155] 0.388107478 0.814468072 0.819988723 0.320406177 0.512019175 0.189866084 0.019102564 0.778045038 0.063532324 0.021660839 0.087123658
[166] 0.371697775 0.017831740 0.174573799 0.072586081 0.050795966 0.321374939 0.390300727 0.242283766 0.101281785 0.477098938 0.177832066
[177] 0.851704388 0.421578801 0.059594070 0.801660505 0.263016503 0.158261796 0.629712769 0.680147379 0.627289909 0.143229332 0.371021820
[188] 0.048405335 0.155912833 0.844592024 0.774738072 0.074975116 0.094313006 0.034029316 0.156403796 0.765185930 0.162409946 0.941491860
[199] 0.098203334 0.096782855 0.013696456 0.086137707 0.665930779 0.328426313 0.230933621 0.045364772 0.067599667 0.128835144 0.552086895
[210] 0.192049128 0.391808734 0.634609576 0.138796509 0.034537822 0.402157076 0.473285370 0.915578006 0.109882027 0.060813059 0.078347861
[221] 0.511021110 0.046236210 0.637413042 0.057352160 0.060578365 0.328120324 0.117022441 0.150080125 0.033383541 0.548421342 0.727231653
[232] 0.273012605 0.006665104 0.023959522 0.212622505 0.263913260 0.304803089 0.282446484 0.528587177 0.053303093 0.042787259 0.895978588
[243] 0.951451693 0.260631793 0.057999466 0.077448786 0.039445750 0.078320973 0.521759602 0.120793953 0.109749728 0.115212481 0.063160685
[254] 0.315382778 0.186348273 0.242141093 0.800887574 0.866564275 0.147824356 0.483279794 0.458255040 0.058388003 0.052876258 0.244883311
[265] 0.761115562 0.021394588 0.531937078 0.751371443 0.307274782 0.801133302 0.005240345 0.656336098 0.109766806 0.101435208 0.023548802
[276] 0.056804667 0.081720211 0.513341731 0.014456472 0.127221754 0.744369844 0.498650317 0.182496315 0.605638441 0.021059011 0.094691510
[287] 0.633177077 0.189201907 0.229657632 0.818999683 0.081933947 0.793780642 0.798845854 0.137588419 0.275762056 0.057395933 0.445742740
[298] 0.584089416 0.070998635 0.209775098 0.174014948 0.294145785 0.743857124 0.126042513 0.893349297 0.712229694 0.217225821 0.135596074
[309] 0.343239883 0.187767754 0.233598292 0.822021476 0.082764167 0.102210424 0.113711375 0.122461316 0.828791325 0.107099346 0.054386091
[320] 0.931938668 0.326454054 0.678618259 0.863704140 0.217542759 0.056249096 0.816489720 0.491806299 0.084796292 0.943486215 0.302404878
[331] 0.132747361 0.037305147 0.053261653 0.902996173 0.042527808 0.787771463 0.031525411 0.220902831 0.054775507 0.642266770 0.520264613
[342] 0.707148463 0.902568015 0.695527581 0.848650675 0.466017086 0.291730904 0.027601848 0.133315806 0.771592655 0.383831136 0.090423918
[353] 0.020481869 0.115239515 0.038125985 0.017056834 0.070184592 0.755542001 0.050653582 0.481007350 0.195086963 0.187977925 0.169394579
[364] 0.377212811 0.151859655 0.475032680 0.186324471 0.612248541 0.023804839 0.007054577 0.085213924 0.171343641 0.900710787 0.150595032
[375] 0.257766676 0.013926514 0.035750449 0.185105131 0.253500436 0.369424730 0.640522481 0.841160836 0.060643162 0.051633327 0.731126069
[386] 0.154040714 0.063202801 0.337255163 0.087712142 0.059196122 0.446522479 0.839581017 0.899946965 0.051162921 0.569809764 0.085461942
[397] 0.080315826 0.343678259 0.504516436 0.092545675 0.175360179 0.310167781 0.720652085 0.094860697 0.905656358 0.432122047 0.742494468
[408] 0.704660222 0.065240504 0.044936864 0.086384200 0.460776518 0.058306508 0.538740077 0.360529087 0.413937339 0.248787673 0.063168325
[419] 0.205549345 0.143823024 0.121451790 0.204643255 0.028047843 0.262047997 0.797845942 0.020192814 0.067782381 0.880235920 0.067820578
[430] 0.093376849 0.145058897 0.885115279 0.023833728 0.172919691 0.023186441 0.343149266 0.491733925 0.334336420 0.182785009 0.107602309
[441] 0.159470782 0.480057756 0.718226410 0.110307283 0.282105476 0.504892387 0.023457816 0.246497165 0.288819782 0.406440777 0.333499471
[452] 0.789228958 0.024672867 0.158285199 0.915532293 0.083660243 0.616972917 0.156244026 0.066104438 0.117576505 0.582609228 0.935907656
[463] 0.494078320 0.906231057 0.044752423 0.098120327 0.817658808 0.063067848 0.048103513 0.094446457 0.009656172 0.457728456 0.371287692
[474] 0.732871561 0.239173153 0.048538537 0.427026826 0.838680152 0.005916331 0.639747396 0.192937289 0.044098532 0.307301900 0.771646053
[485] 0.893235289 0.633989608 0.325705459 0.861507987 0.924405484 0.211878609 0.232857992 0.553168378 0.199630964 0.167297598 0.636698113
[496] 0.102745817 0.412260537 0.037681077 0.499347951 0.561847838 0.108622049 0.036902563 0.275679034 0.142289294 0.929821372 0.853111736
[507] 0.052948764 0.186298288 0.034369934 0.468239290 0.021331580 0.617803456 0.083865824 0.751272138 0.115022996 0.496356896 0.458485256
[518] 0.303064449 0.512265744 0.935001789 0.011659745 0.243551235 0.234201771 0.733582682 0.439827183 0.132566837 0.200183137 0.254534757
[529] 0.620459940 0.187218540 0.128750723 0.801532793</code></pre>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="regresión-logística.html#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(hi <span class="sc">-</span> lo, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>  [1]  0.45 -0.24 -0.25 -0.24  0.63  0.40  0.13 -0.05  0.17 -0.04 -0.23  0.18 -0.24  0.15 -0.07  0.15 -0.14  0.51  0.50 -0.18  0.69  0.52
 [23] -0.24 -0.24 -0.21 -0.23  0.49 -0.26 -0.15 -0.20 -0.05 -0.25  0.03 -0.05 -0.02 -0.12 -0.21 -0.22 -0.10 -0.24  0.17 -0.14  0.53 -0.01
 [45] -0.03 -0.23 -0.19  0.19 -0.25 -0.05  0.14 -0.24  0.47 -0.19  0.60 -0.16  0.15 -0.07  0.41  0.44 -0.04 -0.19 -0.22 -0.01 -0.16  0.19
 [67] -0.25  0.57  0.33  0.62 -0.24  0.71  0.16 -0.02 -0.07  0.01 -0.24  0.59  0.53  0.16 -0.02  0.09 -0.11 -0.14 -0.18  0.70 -0.24  0.24
 [89] -0.01  0.04  0.05  0.43 -0.21 -0.24  0.44  0.50 -0.07  0.47 -0.25  0.65  0.53 -0.24 -0.18  0.27  0.23  0.61  0.57  0.19 -0.22 -0.25
[111] -0.11 -0.09  0.64 -0.14  0.15  0.32  0.57 -0.23 -0.01 -0.15 -0.21 -0.13  0.13  0.23  0.25 -0.23 -0.23 -0.05  0.42  0.02 -0.12  0.09
[133] -0.03  0.46  0.13  0.09  0.06 -0.08  0.38 -0.08  0.49 -0.17 -0.01  0.04 -0.13 -0.15  0.34 -0.23 -0.24 -0.14 -0.19  0.33  0.01 -0.24
[155]  0.12  0.55  0.55  0.06  0.25 -0.08 -0.25  0.51 -0.20 -0.24 -0.18  0.11 -0.25 -0.09 -0.19 -0.21  0.06  0.13 -0.02 -0.16  0.21 -0.09
[177]  0.59  0.16 -0.21  0.54  0.00 -0.11  0.36  0.41  0.36 -0.12  0.11 -0.22 -0.11  0.58  0.51 -0.19 -0.17 -0.23 -0.11  0.50 -0.10  0.68
[199] -0.17 -0.17 -0.25 -0.18  0.40  0.06 -0.03 -0.22 -0.20 -0.14  0.29 -0.07  0.13  0.37 -0.13 -0.23  0.14  0.21  0.65 -0.16 -0.20 -0.19
[221]  0.25 -0.22  0.37 -0.21 -0.20  0.06 -0.15 -0.12 -0.23  0.28  0.46  0.01 -0.26 -0.24 -0.05  0.00  0.04  0.02  0.26 -0.21 -0.22  0.63
[243]  0.69  0.00 -0.21 -0.19 -0.23 -0.19  0.26 -0.14 -0.16 -0.15 -0.20  0.05 -0.08 -0.02  0.54  0.60 -0.12  0.22  0.19 -0.21 -0.21 -0.02
[265]  0.50 -0.24  0.27  0.49  0.04  0.54 -0.26  0.39 -0.16 -0.16 -0.24 -0.21 -0.18  0.25 -0.25 -0.14  0.48  0.23 -0.08  0.34 -0.24 -0.17
[287]  0.37 -0.08 -0.04  0.55 -0.18  0.53  0.53 -0.13  0.01 -0.21  0.18  0.32 -0.19 -0.06 -0.09  0.03  0.48 -0.14  0.63  0.45 -0.05 -0.13
[309]  0.08 -0.08 -0.03  0.56 -0.18 -0.16 -0.15 -0.14  0.56 -0.16 -0.21  0.67  0.06  0.41  0.60 -0.05 -0.21  0.55  0.23 -0.18  0.68  0.04
[331] -0.13 -0.23 -0.21  0.64 -0.22  0.52 -0.23 -0.04 -0.21  0.38  0.26  0.44  0.64  0.43  0.58  0.20  0.03 -0.24 -0.13  0.51  0.12 -0.17
[353] -0.24 -0.15 -0.23 -0.25 -0.20  0.49 -0.21  0.22 -0.07 -0.08 -0.10  0.11 -0.11  0.21 -0.08  0.35 -0.24 -0.26 -0.18 -0.09  0.64 -0.11
[375] -0.01 -0.25 -0.23 -0.08 -0.01  0.10  0.38  0.58 -0.20 -0.21  0.47 -0.11 -0.20  0.07 -0.18 -0.21  0.18  0.57  0.63 -0.21  0.30 -0.18
[397] -0.18  0.08  0.24 -0.17 -0.09  0.04  0.46 -0.17  0.64  0.17  0.48  0.44 -0.20 -0.22 -0.18  0.20 -0.21  0.27  0.10  0.15 -0.02 -0.20
[419] -0.06 -0.12 -0.14 -0.06 -0.24  0.00  0.53 -0.25 -0.20  0.62 -0.20 -0.17 -0.12  0.62 -0.24 -0.09 -0.24  0.08  0.23  0.07 -0.08 -0.16
[441] -0.11  0.21  0.45 -0.15  0.02  0.24 -0.24 -0.02  0.02  0.14  0.07  0.52 -0.24 -0.11  0.65 -0.18  0.35 -0.11 -0.20 -0.15  0.32  0.67
[463]  0.23  0.64 -0.22 -0.17  0.55 -0.20 -0.22 -0.17 -0.26  0.19  0.11  0.47 -0.03 -0.22  0.16  0.57 -0.26  0.37 -0.07 -0.22  0.04  0.51
[485]  0.63  0.37  0.06  0.60  0.66 -0.05 -0.03  0.29 -0.07 -0.10  0.37 -0.16  0.15 -0.23  0.23  0.30 -0.16 -0.23  0.01 -0.12  0.66  0.59
[507] -0.21 -0.08 -0.23  0.20 -0.24  0.35 -0.18  0.49 -0.15  0.23  0.19  0.04  0.25  0.67 -0.25 -0.02 -0.03  0.47  0.17 -0.13 -0.07 -0.01
[529]  0.36 -0.08 -0.14  0.54</code></pre>
</div>
</div>
<div id="creación-de-un-modelo-y-validación" class="section level2" number="4.7">
<h2><span class="header-section-number">4.7</span> Creación de un modelo y validación</h2>
<p>La creación de un modelo predictivo mediante regresión logística se puede llevar a cabo mediante técnicas de <code>stepwise</code> que ya hemos visto en otros cursos. En R, podemos llevar a cabo dicha metodología usando la función <code>step</code> (que se basa en el test de razón de verosimilitud) o <code>stepAIC</code> (que usa el criterio de Akaike - AIC) de la librería MASS. Lo aprendido anteriormente en el tema de validación cruzada nos servirá oara evaluar la capacidad de un modelo. Veámoslo con un ejemplo.</p>
<p>Supongamos que queremos elegir el mejor modelo para predecir el riesgo de diabetes y queremos validarlo con valización cruzada. Todos los pasos y métodos que hemos aprendido en las lecciones anteriores, podemos realizarlos de la siguiente manera. Usaremos los datos train y test que hay por defecto (Pima.tr y Pima.te). Para la validación cruzada usaremos la librería <code>caret</code> que veremos en detalle más adelante.</p>
<p>Empecemos seleccionando el mejor modelo en los datos de entrenamiento con un stepwise hacia atrás</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="regresión-logística.html#cb88-1" aria-hidden="true" tabindex="-1"></a>mod.all <span class="ot">&lt;-</span> <span class="fu">glm</span>(type <span class="sc">~</span> ., <span class="at">data=</span>Pima.tr, <span class="at">family=</span><span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb88-2"><a href="regresión-logística.html#cb88-2" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">step</span>(mod.all, <span class="at">trace=</span><span class="cn">FALSE</span>, <span class="at">direction=</span><span class="st">&quot;backward&quot;</span>)</span>
<span id="cb88-3"><a href="regresión-logística.html#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod)</span></code></pre></div>
<pre><code>
Call:
glm(formula = type ~ npreg + glu + bmi + ped + age, family = &quot;binomial&quot;, 
    data = Pima.tr)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.0009  -0.6816  -0.3664   0.6467   2.2898  

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -9.938059   1.541571  -6.447 1.14e-10 ***
npreg        0.103142   0.064517   1.599  0.10989    
glu          0.031809   0.006667   4.771 1.83e-06 ***
bmi          0.079672   0.032649   2.440  0.01468 *  
ped          1.811417   0.661048   2.740  0.00614 ** 
age          0.039286   0.020967   1.874  0.06097 .  
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 256.41  on 199  degrees of freedom
Residual deviance: 178.47  on 194  degrees of freedom
AIC: 190.47

Number of Fisher Scoring iterations: 5</code></pre>
<p>Podemos evaluar la capacidad predictiva en la muestra test mediante</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="regresión-logística.html#cb90-1" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod, <span class="at">newdata =</span> Pima.te, <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb90-2"><a href="regresión-logística.html#cb90-2" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(preds <span class="sc">&gt;=</span> .<span class="dv">5</span>, <span class="st">&quot;Yes&quot;</span>, <span class="st">&quot;No&quot;</span>) )</span>
<span id="cb90-3"><a href="regresión-logística.html#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(preds, Pima.te<span class="sc">$</span>type)</span></code></pre></div>
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction  No Yes
       No  199  42
       Yes  24  67
                                          
               Accuracy : 0.8012          
                 95% CI : (0.7542, 0.8428)
    No Information Rate : 0.6717          
    P-Value [Acc &gt; NIR] : 1.116e-07       
                                          
                  Kappa : 0.5294          
                                          
 Mcnemar&#39;s Test P-Value : 0.03639         
                                          
            Sensitivity : 0.8924          
            Specificity : 0.6147          
         Pos Pred Value : 0.8257          
         Neg Pred Value : 0.7363          
             Prevalence : 0.6717          
         Detection Rate : 0.5994          
   Detection Prevalence : 0.7259          
      Balanced Accuracy : 0.7535          
                                          
       &#39;Positive&#39; Class : No              
                                          </code></pre>
<p>y calcular la capacidad predictiva en la muestra train del modelo completo utilizando un método de 5-fold cross-validation mediante:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="regresión-logística.html#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb92-2"><a href="regresión-logística.html#cb92-2" aria-hidden="true" tabindex="-1"></a>mod.train <span class="ot">&lt;-</span> <span class="fu">train</span>(type <span class="sc">~</span> ., <span class="at">data=</span>Pima.tr, </span>
<span id="cb92-3"><a href="regresión-logística.html#cb92-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method=</span><span class="st">&quot;cv&quot;</span>, <span class="at">number=</span><span class="dv">5</span>),</span>
<span id="cb92-4"><a href="regresión-logística.html#cb92-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">method =</span> <span class="st">&quot;glm&quot;</span>, <span class="at">family=</span><span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb92-5"><a href="regresión-logística.html#cb92-5" aria-hidden="true" tabindex="-1"></a>mod.train</span></code></pre></div>
<pre><code>Generalized Linear Model 

200 samples
  7 predictor
  2 classes: &#39;No&#39;, &#39;Yes&#39; 

No pre-processing
Resampling: Cross-Validated (5 fold) 
Summary of sample sizes: 160, 160, 159, 160, 161 
Resampling results:

  Accuracy   Kappa    
  0.7553283  0.4381235</code></pre>
<p>la capcidad predictiva para el modelo seleccionado mediante <em>stepwise</em> se calcularía mediante:</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="regresión-logística.html#cb94-1" aria-hidden="true" tabindex="-1"></a>mod.train<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">train</span>(<span class="fu">formula</span>(mod), <span class="at">data=</span>Pima.tr, </span>
<span id="cb94-2"><a href="regresión-logística.html#cb94-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method=</span><span class="st">&quot;cv&quot;</span>, <span class="at">number=</span><span class="dv">5</span>),</span>
<span id="cb94-3"><a href="regresión-logística.html#cb94-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">method =</span> <span class="st">&quot;glm&quot;</span>, <span class="at">family=</span><span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb94-4"><a href="regresión-logística.html#cb94-4" aria-hidden="true" tabindex="-1"></a>mod.train<span class="fl">.2</span></span></code></pre></div>
<pre><code>Generalized Linear Model 

200 samples
  5 predictor
  2 classes: &#39;No&#39;, &#39;Yes&#39; 

No pre-processing
Resampling: Cross-Validated (5 fold) 
Summary of sample sizes: 160, 159, 160, 160, 161 
Resampling results:

  Accuracy   Kappa    
  0.7854503  0.5003265</code></pre>
<p>Comprobamos como el modelo completo tiene mejor accuracy, pero ya hemos visto que esto es un problema de sobreajuste. Validemos los modelos con la muestra test:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="regresión-logística.html#cb96-1" aria-hidden="true" tabindex="-1"></a>mod.test <span class="ot">&lt;-</span> <span class="fu">train</span>(type <span class="sc">~</span> ., <span class="at">data=</span>Pima.te, </span>
<span id="cb96-2"><a href="regresión-logística.html#cb96-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method=</span><span class="st">&quot;cv&quot;</span>, <span class="at">number=</span><span class="dv">5</span>),</span>
<span id="cb96-3"><a href="regresión-logística.html#cb96-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">method =</span> <span class="st">&quot;glm&quot;</span>, <span class="at">family=</span><span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb96-4"><a href="regresión-logística.html#cb96-4" aria-hidden="true" tabindex="-1"></a>mod.test</span></code></pre></div>
<pre><code>Generalized Linear Model 

332 samples
  7 predictor
  2 classes: &#39;No&#39;, &#39;Yes&#39; 

No pre-processing
Resampling: Cross-Validated (5 fold) 
Summary of sample sizes: 266, 265, 266, 266, 265 
Resampling results:

  Accuracy   Kappa    
  0.7769787  0.4543523</code></pre>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="regresión-logística.html#cb98-1" aria-hidden="true" tabindex="-1"></a>mod.test<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">train</span>(<span class="fu">formula</span>(mod), <span class="at">data=</span>Pima.te, </span>
<span id="cb98-2"><a href="regresión-logística.html#cb98-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method=</span><span class="st">&quot;cv&quot;</span>, <span class="at">number=</span><span class="dv">5</span>),</span>
<span id="cb98-3"><a href="regresión-logística.html#cb98-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">method =</span> <span class="st">&quot;glm&quot;</span>, <span class="at">family=</span><span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb98-4"><a href="regresión-logística.html#cb98-4" aria-hidden="true" tabindex="-1"></a>mod.test<span class="fl">.2</span></span></code></pre></div>
<pre><code>Generalized Linear Model 

332 samples
  5 predictor
  2 classes: &#39;No&#39;, &#39;Yes&#39; 

No pre-processing
Resampling: Cross-Validated (5 fold) 
Summary of sample sizes: 266, 266, 265, 265, 266 
Resampling results:

  Accuracy   Kappa    
  0.7949796  0.5130989</code></pre>
<p>Vemos que en este caso el modelo obtenido mediante <em>stepwise</em> tiene una mejor capacidad predictiva en la muestra test, lo que demuestra que es un modelo más adecuado para hacer usar en la práctica.</p>
<p>Notemos que la librería <code>caret</code> es muy flexible y nos permite mediante una única función <code>train</code>, estimar el modelo y evaluarlo mediante validación cruzada usando el argumento <code>trControl</code>. A lo largo del curso veremos que cambiando el argumento <code>method</code> podremos usar cualquier método de aprendizaje automático que existe. También veremos otros argumentos que nos permitirán llevar a cabo otros pasos necesarios a la hora de crear un modelo predictivo.</p>
</div>
<div id="nomogramas" class="section level2" number="4.8">
<h2><span class="header-section-number">4.8</span> Nomogramas</h2>
<p>Una vez que ya tenemos creado y validad un modelo predictivo, nos puede interesar aplicarlo en otros individuos para poder tomar decisiones. Para ello, podemos usar nomogramas.</p>
<p>Un nomograma es una representación gráfica que permite realizar con rapidez cálculos numéricos aproximados. Dentro del campo de la medicina, es frecuente que este tipo de gráficos este asociado al calculo de probabilidades de ocurrencia de un evento o una característica asociada a una enfermedad. Es lo que se conoce como <strong>Medicina Translacional</strong>.</p>
<p>Aunque existen otro tipo de herramientas de cálculo vía web para estas probabilidades (Shiny), el uso de nomogramas esta muy extendido en el campo de la biomedicina como por ejemplo en el calculo de probabilidades de recurrencia en distintos tipos de cáncer, la probabilidad de supervivencia a un mes tras un infarto, o el pronóstico tras un diagnóstico de cáncer a cierto tiempo (en ese caso se usan modelos de supervivencia. Así pues, la regresión logística será una de las herramientas con una aplicación más directa y sencilla en el aprendizaje automático, donde el uso de los modelos predictivos suelen tener un aplicabilidad directa en la población.</p>
<p>Existen numerosas herramientas para crear nomogramas en R, empecemos con la creación de nomogramas sencillos. Para ello usaremos los datos del ejemplo de diabetes con el modelo que hemos obtenido y validado anteriormente. Para usar la librería <code>rms</code> necesitamos que el modelo esté estimado con la función <code>lrm ()</code></p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="regresión-logística.html#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rms)</span>
<span id="cb100-2"><a href="regresión-logística.html#cb100-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-3"><a href="regresión-logística.html#cb100-3" aria-hidden="true" tabindex="-1"></a>t.data <span class="ot">&lt;-</span> <span class="fu">datadist</span>(Pima.tr)</span>
<span id="cb100-4"><a href="regresión-logística.html#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">datadist =</span> <span class="st">&#39;t.data&#39;</span>)</span>
<span id="cb100-5"><a href="regresión-logística.html#cb100-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-6"><a href="regresión-logística.html#cb100-6" aria-hidden="true" tabindex="-1"></a>mod.lrm <span class="ot">&lt;-</span> <span class="fu">lrm</span>(type <span class="sc">~</span> npreg <span class="sc">+</span> glu <span class="sc">+</span> bmi <span class="sc">+</span> ped <span class="sc">+</span> age, <span class="at">data=</span>Pima.tr)</span>
<span id="cb100-7"><a href="regresión-logística.html#cb100-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-8"><a href="regresión-logística.html#cb100-8" aria-hidden="true" tabindex="-1"></a>nom <span class="ot">&lt;-</span> <span class="fu">nomogram</span>(mod.lrm, <span class="at">fun =</span> plogis, <span class="at">funlabel=</span><span class="st">&quot;Risk of diabetes&quot;</span>)</span>
<span id="cb100-9"><a href="regresión-logística.html#cb100-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nom)</span></code></pre></div>
<p><img src="fig_out/unnamed-chunk-52-1.png" width="768" /></p>
<p>Supongamos que llega a la consulta una persona con un bmi de 35. Eso sumaría 30 puntos (basta con subir hacia arriba y ver qué valor de ‘Points’ corresponde a un bmi de 35). Una edad de 50 años (~22 puntos), una función del pedigrí de la diabetes de 1.8 (~62 puntos), una glucosa de 120 (~50 puntos) y 0 embarazos que sumaría 0 puntos. En total, el paciente suma un total de 164 puntos. Si ahora vamos a la línea de ‘Total Points’ y proyectamos sobre el predictor lineal de aproximadamente ~1.9 que se asocia con un riesgo de diabetes ligeramente superior al 80% (proyectar sobre ‘Risk of diabetes’).</p>
<p>Obviamente estos cálculos se pueden hacer de forma más directa calculando la predicción sobre este individuo con el objeto de R</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="regresión-logística.html#cb101-1" aria-hidden="true" tabindex="-1"></a>indiv <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">bmi=</span><span class="dv">35</span>, <span class="at">age=</span><span class="dv">50</span>, <span class="at">ped=</span><span class="fl">1.8</span>, <span class="at">glu=</span><span class="dv">120</span>, <span class="at">npreg=</span><span class="dv">0</span>)</span>
<span id="cb101-2"><a href="regresión-logística.html#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(mod.lrm, <span class="at">newdata =</span> indiv, <span class="at">type=</span><span class="st">&quot;lp&quot;</span>)</span></code></pre></div>
<pre><code>       1 
1.892376 </code></pre>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="regresión-logística.html#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(mod.lrm, <span class="at">newdata =</span> indiv, <span class="at">type =</span> <span class="st">&quot;fitted&quot;</span>)</span></code></pre></div>
<pre><code>        1 
0.8690262 </code></pre>
<p>Estos cálculos se pueden programar en R y hace una función, o también una aplicación Shiny para aquellos médicos que no sepan usar R (los nomogramas se siguen utilizando). Otra opción es que hagamos uso de una librería para hacer nomogramas dinámicos (crea Shiny app) de forma sencilla con la librería <code>DynNom</code></p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="regresión-logística.html#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DynNom)</span>
<span id="cb105-2"><a href="regresión-logística.html#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="fu">DynNom</span>(mod, Pima.tr)</span></code></pre></div>
<p>Con estas simples instrucciones obtendríamos esta aplicación Shiny (Figura abajo) donde cada intervalo de confianza corresponde a un cálculo obtenido variando alguna de las variables predictoras</p>
<div class="figure">
<img src="figures/nomograma.png" alt="" />
<p class="caption">Nomograma para el modelo de predicción para diabetes</p>
</div>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="2">
<li id="fn2"><p>GLM significa modelo lineal generalizado. Esta función se ajustará a una variedad de modelos no lineales. Por ejemplo, podríamos especificar una regresión de Poisson con <code>family = poisson</code>.<a href="regresión-logística.html#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>Para obtener más detalles, se puede consultar este texto [How to interpret odds ratio in logistic regression?] (<a href="Https://stats.idre.ucla.edu/other/mult-pkg/faq/general/faq-how-do-i-interpret-odds-ratios-in-logistic-regression/" class="uri">Https://stats.idre.ucla.edu/other/mult-pkg/faq/general/faq-how-do-i-interpret-odds-ratios-in-logistic-regression/</a>).<a href="regresión-logística.html#fnref3" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="validación-cruzada.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="caret.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/isglobal-brge/curso_machine_learning/tree/master/docs03-regresion_logistica.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
